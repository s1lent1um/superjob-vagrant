# vim: set foldmethod=indent filetype=apache :










#default
<VirtualHost *:81>
	ServerName 0sjob.default
	DocumentRoot /srv/src/0sjob

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	ErrorLog /srv/src/0sjob.var/apache/0sjob.default_error.log
	CustomLog /srv/src/0sjob.var/apache/0sjob.default_access.log combined

	php_value auto_append_file /srv/src/0sjob/config/close_connect.php
	php_value auto_prepend_file /srv/src/0sjob/config/connect.php
</VirtualHost>

<VirtualHost *:81>
	ServerName 0sjob.ctl
	DocumentRoot /srv/src/0sjob
	Alias /public /srv/src/0sjob.public/

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	ErrorLog /srv/src/0sjob.var/apache/0sjob.ctl_error.log
	CustomLog /srv/src/0sjob.var/apache/0sjob.ctl_access.log combined

	<Directory /srv/src/0sjob>
		Require all denied
	</Directory>

	<Directory /srv/src/0sjob/admin/remote_scripts>
		Require ip 127.0.0.1 10.10.0.0/16
	</Directory>

	# Для работы backuper при скачивании файлов файлов с хостов pbeNN
	<Directory /srv/src/0sjob.public/>
		Require ip 127.0.0.1 10.10.0.0/16
	</Directory>
</VirtualHost>


#public
<VirtualHost *:81>
	ServerName public.0sjob.ru
	ServerAlias public.0sjob.ua
	ServerAlias public.0sjob.uz
	# Infosponsors
	ServerAlias public.0pr.ru
	DocumentRoot /srv/src/0sjob.public
	ErrorLog /srv/src/0sjob.var/apache/public.0sjob_error.log
	CustomLog /dev/null common

		<Directory /srv/src/0sjob.public>
			Order Deny,Allow
			Require all granted
			AllowOverride None
			RewriteEngine On
			php_flag engine off
			RewriteRule ^ssl/public/(.*)$ /$1 [L]
			RewriteRule ^images/(.*)_[a-f0-9]{32}\.(jpg|png|gif) /images/$1.$2 [L]
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log
			<FilesMatch "\.(php3?|html|phtml|inc)$">
				Require all denied
			</FilesMatch>

			# Все эти картинки были перемещены(devsystem-934) в spreaded и разложены по двухуровневой стуктуре, правила нужны для работы по старым url
			RewriteCond %{REQUEST_URI} ^/images/feedback.ru/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/research/answers_files/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/agency_logos.ru/ [OR]
			RewriteCond %{REQUEST_URI} ^/files/students_csv/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/zarplatomer.ru/(big|small) [OR]
			RewriteCond %{REQUEST_URI} ^/images/uploaded_temp/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/contests.ru/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/research/uploads/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/groups.ru/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/profi_authors/ [OR]
			RewriteCond %{REQUEST_URI} ^/images/community.ru/
			RewriteRule / /spreaded%{REQUEST_URI} [L]

			RewriteCond %{REQUEST_URI} ^/images/groups_topics_attaches.ru
			RewriteRule [0-9]+(:?_[a-zA-Z]+)?\.[a-zA-Z0-9]{1,5}$ /_spreader/0000$0%{REQUEST_URI} [L]
		</Directory>

		<Directory /srv/src/0sjob.public/files/uploaded/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob.public/research/download/>
			Options +Indexes
			IndexIgnore ..
			IndexOptions NameWidth=* +SuppressColumnSorting +SuppressDescription +FancyIndexing +IgnoreCase
			IndexOrderDefault Ascending Name
			AddDefaultCharset utf-8
			<Files ~ "^index\.(p?html|php)$">
				Require all granted
			</Files>
		</Directory>

		<Directory /srv/src/0sjob.public/images/converters/>
			php_flag engine on
			php_value auto_prepend_file none
			<FilesMatch "\.(php3?|html|phtml|inc)$">
				Require all granted
			</FilesMatch>
		</Directory>


		<Directory /srv/src/0sjob.public/spreaded/files/students_csv/>
			# Поскольку эти админские файлы доступны напрямую для скачивания, попробуем хоть как-то ограничить доступ
			Require ip 127.0.0.1/8 10.10.0.0/16 172.16.2.0/23
		</Directory>

		# Файлы защищенные от скачивания из внешних сетей
		<Directory /srv/src/0sjob.public/spreaded/restricted>
			Require ip 127.0.0.1/8 10.10.0.0/16 172.16.2.0/23
		</Directory>

		<Directory /srv/src/0sjob.public/spreaded/>
			RewriteEngine on
			# Если путь БЕЗ двухуровневой структуры - надо преобразовать
			# URL вида .../XXXNNN.ext в физическо местонахождение файла в двухуровневой иерархии каталогов (см. Location /_spreader)
			RewriteCond %{REQUEST_URI} !/[0-9]{2}/[0-9]{3}/[^/]+$
			RewriteRule [0-9]+\.[a-zA-Z0-9]{1,5}$ /_spreader/0000$0%{REQUEST_URI} [L]
		</Directory>

		# Распределитель файлов по каталогам
		# https://conf.superjob.ru/display/DEV/User+file+processing+and+storage
		#
		# Принцип работы:
		# Если в какой-либо каталог, в котором применяется распределение файлов по двухуровневой иерархии,
		# пришел url формата path/XXXNN.ext, где XXXNN - любое целое больше единицы, то нужно найти подкаталоги в которых находится этот файл,
		# для этого
		#    * XXXNN всегда дополняется четырьмя нулями 0000XXXNN.ext (чтобы не было проблем с числами длиной менее 5 знаков)
		#    * Реврайтится по следующему правилу: /_spreader/0000XXXNN.ext/original_path/original_file
		#    * Попадает в этот location, где преобразуется в формат соответствующий физическому расположению файла: original_path/NN/XXX/original_file
		#    Замечания:
		#     Этот _spreader можно использовать для любых каталогов с соответствующей структурой, не только для images,
		#     т.к. на входе ожидается изначальный request_uri
		#     Если изначальный request_uri НЕ начинается с /spreader/, то этот префикс автоматически добавляется
		#
		#
		# Пример:
		# Изначальный uri:                  images/feedback.ru/123.doc
		# Преборазуется в:                  /_spreader/0000123.doc/images/feedback.ru/123.doc
		#                                   |                     ^---Изначальный request_uri целиком
		#                                   ^---Вспомогательный префикс
		#
		# Результатом преобразования будет: /spreaded/images/feedback.ru/23/001/123.doc
		<Location /_spreader/>
			RewriteEngine on

			# Если изначальный URI уже содержит префикс spreaded, то не добавляем его
			RewriteCond %{REQUEST_URI} ^/_spreader/0[^/]+/spreaded/
			RewriteRule /_spreader/[0-9]*([0-9]{3})([0-9]{2})[^/]+/(.*)/([^/]+)$ /$3/$2/$1/$4 [L]

			# Добавляем префикс spreaded, если он отсутствовал
			RewriteRule /_spreader/[0-9]*([0-9]{3})([0-9]{2})[^/]+/(.*)/([^/]+)$ /spreaded/$3/$2/$1/$4 [L]
		</Location>

		<Directory /srv/src/0sjob.public/spreaded/images/groups_topics_attaches.ru/>
			RewriteEngine on

			RewriteRule ^copyright.php$ - [L]
			RewriteCond %{QUERY_STRING} !=origin [OR]
			RewriteCond %{REMOTE_ADDR} !^10\.10\.
			RewriteRule ^([a-zA-Z0-9_\-\/]+)+([a-zA-Z0-9_\-]+).(jpeg|jpg|gif|png) /images/converters/copyright.php
		</Directory>

</VirtualHost>


#api
<VirtualHost *:81>
	ServerName api.0sjob.ru
	ServerAlias api.0sjob.ua
	ServerAlias api.0sjob.uz
	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/api.0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/api.0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	AddType text/x-component .htc

		<Directory /srv/src/0sjob>
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log
			Require all granted
			php_flag engine on
			php_value auto_prepend_file /srv/src/0sjob/api/html/includes/connect.php
			php_value auto_append_file /srv/src/0sjob/config/close_connect.php
			php_value max_input_vars 10000
			ErrorDocument 404 /api/html/404.html
			RewriteEngine On
			RewriteCond $0 !\.(gif|jpg|png|ico|css|js|swf|wav|mp3|less|cur)$
			RewriteRule ^.*$ api/html/index.html
		</Directory>

		<Directory /srv/src/0sjob/api/html/includes>
			Require all denied
		</Directory>

</VirtualHost>

#img
<VirtualHost *:81>
	ServerName img.0sjob.ru
	ServerAlias img.0sjob.ua
	ServerAlias img.0sjob.uz
	ServerAlias img.0pr.ru
	ServerAlias st.0sjob.ru
	ServerAlias st.0sjob.ua
	ServerAlias st.0sjob.uz
	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/img.0sjob.ru_error.log
	CustomLog /dev/null common

		<FilesMatch "\.(php3?|html|phtml|inc)$">
			Require all denied
		</FilesMatch>

		<Directory /srv/src/0sjob/>
			Require all denied
		</Directory>

		Alias /hr/public /srv/src/0sjob/yii/protected/modules/hr/public
		<Location /hr/public>
			Require all granted
			Header set Access-Control-Allow-Origin "*"
			Header set Access-Control-Allow-Headers "X-Requested-With"
			AddDefaultCharset utf-8
			ExpiresActive on
			ExpiresDefault "now plus 1 month"

			php_flag engine off
		</Location>

		Alias /studentswork/public /srv/src/0sjob/yii/protected/modules/studentswork/public
		<Location /studentswork/public>
			Require all granted
			Header set Access-Control-Allow-Origin "*"
			Header set Access-Control-Allow-Headers "X-Requested-With"
			AddDefaultCharset utf-8
			ExpiresActive on
			ExpiresDefault "now plus 1 month"

			php_flag engine off
		</Location>

		<Directory /srv/src/0sjob/img/>
			<FilesMatch "\.(woff|otf|ttf|eot)$">
				Header set Access-Control-Allow-Origin "*"
			</FilesMatch>
			Require all granted
			php_flag engine off
			ExpiresActive on
			ExpiresDefault "now plus 1 month"
		</Directory>
		<Directory /srv/src/0sjob/js/3party/>
			Require all granted
			php_flag engine off
		</Directory>
</VirtualHost>

# hr.superjob.ua, hr.superjob.uz = > hr.superjob.ru
<VirtualHost *:81>
	ServerAlias hr.0sjob.ua
	ServerAlias hr.0sjob.uz
	RedirectPermanent / http://hr.0sjob.ru/
</VirtualHost>

# student.superjob.ua, student.superjob.uz = > students.superjob.ru
<VirtualHost *:81>
	ServerAlias students.0sjob.ua
	ServerAlias students.0sjob.uz
	RedirectPermanent / http://students.0sjob.ru/
</VirtualHost>

<VirtualHost *:81>
	ServerName studentsapi.0sjob.ru
	ServerAlias studentsapi.0sjob.ru

	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/studentsapi.0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/studentsapi.0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	php_flag magic_quotes_gpc off
	AddType text/x-component .htc

	Alias /public /srv/src/0sjob/yii/protected/modules/studentsapi/public

	<Directory /srv/src/0sjob>
			Require all granted
			AllowOverride None

			ErrorDocument 404 /404.html
			php_value auto_append_file /srv/src/0sjob/config/close_connect.php
			php_value auto_prepend_file /srv/src/0sjob/api/html/includes/connect.php

			# Лог ошибок PHP
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log

			RewriteEngine On
			RewriteRule ^yii/protected/modules/studentsapi/public/ - [L]


			RewriteCond %{REQUEST_URI} \.(css|jpg|gif|png|zip|rar|doc|xls|js|tif|tiff|docx|xlsx|ico|ttf|otf|woff|woff2)$
			RewriteRule ^(.*)$ /public/swagger/dist/$1 [L,QSA]

			RewriteRule ^index.html$ /public/swagger/dist/index.html [NC,L]

			RewriteRule ^.+$ /public/index.html [NC,L]
	</Directory>

</VirtualHost>


#students
<VirtualHost *:81>
	ServerName students.0sjob.ru
	ServerAlias students.0sjob.ru

	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/students.0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/students.0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	php_flag magic_quotes_gpc off
	AddType text/x-component .htc

		Alias /st/studentswork/public /srv/src/0sjob/yii/protected/modules/studentswork/public
		<Location /st/studentswork/public>
			Require all granted
			AddDefaultCharset utf-8
			Header set Access-Control-Allow-Origin "*"
			Header set Access-Control-Allow-Headers "X-Requested-With"
			ExpiresActive on
			ExpiresDefault "now plus 1 month"

			php_flag engine off
		</Location>

		<Directory /srv/src/0sjob/>
			Require all granted
			AllowOverride None

			ErrorDocument 404 /404.html
			php_value auto_append_file /srv/src/0sjob/config/close_connect.php
			php_value auto_prepend_file /srv/src/0sjob/config/connect.php

			# Лог ошибок PHP
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log

			RewriteEngine On
			RewriteCond %{REQUEST_URI} ^/js/request/js_error.php
			RewriteRule ^(.*)$ $1 [L]


# Обращение к файлам Я.Вебмастер
RewriteRule ^(yandex_.+\.txt)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^(yandex_.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация mail.ru
RewriteRule ^(wmail_.+\.html)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^mailru-verification(.+)\.html$ /webmasters_verification.php?st=$1&type=mailru_postmaster [L]

# Верификация google
RewriteRule ^(google.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация bing
RewriteRule ^(BingSiteAuth.xml)$ /webmasters_verification.php?st=$1 [L]

# Верификация googleadx
RewriteRule ^(googleadx.+\.html)$ /webmasters_verification.php?st=$1 [L]

RewriteRule ^webmasters_verification.php$ - [L]


			RewriteRule ^apple-touch-icon-precomposed.png$ http://img.0sjob.ru/img/ico/mobile/other/apple-touch-icon-114x114.png [L,R=301]
			RewriteRule ^apple-touch-icon.png$ http://img.0sjob.ru/img/ico/mobile/ios/apple-touch-icon-114x114.png [L,R=301]
			RewriteRule ^favicon.ico$ - [L]
			RewriteRule ^admin(.*) http://www.0sjob.ru/admin$1 [R=301,L]
			RewriteRule ^students/(.*) http://students.0sjob.ru/$1 [R=301,L]

			RewriteRule ^robots.txt$ /robots.php [L]
			RewriteRule ^robots.php$ - [L]
			RewriteRule ^yii/protected/modules/studentswork/public/ - [L]

			# STU-1379
			RewriteRule ^news/?$ /novosti/ [R=301,L]
			RewriteRule ^news/(.*)$ /novosti/$1 [R=301,L]

			RewriteRule ^.*$ index.html [NC,L]
		</Directory>

</VirtualHost>

#hr
<VirtualHost *:81>
	ServerName hr.0sjob.ru
	ServerAlias hr.0sjob.ru

	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/hr.0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/hr.0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	php_flag magic_quotes_gpc off
	AddType text/x-component .htc

		<Directory /srv/src/0sjob/>
			Require all granted
			AllowOverride None

			ErrorDocument 404 /404.html
			php_value auto_append_file /srv/src/0sjob/config/close_connect.php
			php_value auto_prepend_file /srv/src/0sjob/config/connect.php

			# Лог ошибок PHP
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log

			RewriteEngine On
			RewriteCond %{REQUEST_URI} ^/js/request/js_error.php
			RewriteRule ^(.*)$ $1 [L]


# Обращение к файлам Я.Вебмастер
RewriteRule ^(yandex_.+\.txt)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^(yandex_.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация mail.ru
RewriteRule ^(wmail_.+\.html)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^mailru-verification(.+)\.html$ /webmasters_verification.php?st=$1&type=mailru_postmaster [L]

# Верификация google
RewriteRule ^(google.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация bing
RewriteRule ^(BingSiteAuth.xml)$ /webmasters_verification.php?st=$1 [L]

# Верификация googleadx
RewriteRule ^(googleadx.+\.html)$ /webmasters_verification.php?st=$1 [L]

RewriteRule ^webmasters_verification.php$ - [L]


			RewriteRule ^apple-touch-icon-precomposed.png$ http://img.0sjob.ru/img/ico/mobile/other/apple-touch-icon-114x114.png [L,R=301]
			RewriteRule ^apple-touch-icon.png$ http://img.0sjob.ru/img/ico/mobile/ios/apple-touch-icon-114x114.png [L,R=301]
			RewriteRule ^favicon.ico$ - [L]
			RewriteRule ^admin(.*) http://www.0sjob.ru/admin$1 [R=301,L]

			RewriteRule ^robots.txt$ /robots.php [L]
			RewriteRule ^robots.php$ - [L]

			RewriteRule ^.*$ index.html [NC,L]
		</Directory>

</VirtualHost>

# student.superjob.ru = > students.superjob.ru
<VirtualHost *:81>
	ServerName student.0sjob.ru
	ServerAlias student.0sjob.ru

	RedirectPermanent / http://students.0sjob.ru/
</VirtualHost>

#services
<VirtualHost *:81>
    ServerName services.0sjob.ru
    ServerAlias services.0sjob.ru
    DocumentRoot /srv/src/0sjob
    ErrorLog /srv/src/0sjob.var/apache/services.0sjob.ru_error.log
    CustomLog /srv/src/0sjob.var/apache/services.0sjob.ru_access.log combined

    AddType text/html .php .php3 .html .phtml .inc
    AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

    php_value blitz.enable_comments 1
    php_value blitz.enable_alternative_tags 0
    AddType text/x-component .htc

    Alias /st/services/public /srv/src/0sjob/yii/protected/modules/services/public
    <Location /st/services/public>
        Require all granted
        Header set Access-Control-Allow-Origin "*"
        Header set Access-Control-Allow-Headers "X-Requested-With"
        ExpiresActive on
        ExpiresDefault "now plus 1 month"
        AddDefaultCharset utf-8

        php_flag engine off
    </Location>

    <Directory /srv/src/0sjob/yii/protected/modules/services/public>
        RewriteCond $0 !\.(png|ico|css|js|ttf)$
        RewriteRule ^.*$ index.html [NC,L]
    </Directory>

    <Directory /srv/src/0sjob>
        php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log
        Require all granted
        php_flag engine on
        php_value auto_prepend_file /srv/src/0sjob/config/connect.php
        php_value auto_append_file /srv/src/0sjob/config/close_connect.php
        ErrorDocument 404 /404.html
        RewriteEngine On
        RewriteRule ^.*$ index.html [NC,L]
    </Directory>
</VirtualHost>

#superjob
<VirtualHost *:81>
	ServerName 0sjob.ru
	ServerAlias *.0sjob.ru
	ServerAlias *.0sjob.ua 0sjob.ua
	ServerAlias *.0sjob.uz 0sjob.uz
	ServerAlias *.zarplatomer.ru
	ServerAlias *.zarplatomer.ua
	# Домен для тестирования зарплатомера (в superjob.conf может не быть всех вариантов таких доменов)
	ServerAlias *.zarplatomer-0sjob.ru
	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	php_flag magic_quotes_gpc off
	php_flag register_globals off
	AddType text/x-component .htc

        Alias /st/hr/public /srv/src/0sjob/yii/protected/modules/hr/public
        <Location /st/hr/public>
            Require all granted
            Header set Access-Control-Allow-Origin "*"
            Header set Access-Control-Allow-Headers "X-Requested-With"
            ExpiresActive on
            ExpiresDefault "now plus 1 month"
            AddDefaultCharset utf-8

            php_flag engine off
        </Location>

		Alias /st/cv/public /srv/src/0sjob/yii/protected/modules/cv/public
		<Location /st/cv/public>
			Require all granted
			Header set Access-Control-Allow-Origin "*"
			Header set Access-Control-Allow-Headers "X-Requested-With"
			ExpiresActive on
			ExpiresDefault "now plus 1 month"
			AddDefaultCharset utf-8

			php_flag engine off
		</Location>

		<Directory /srv/src/0sjob/>
			Require all granted
			AllowOverride None

			ErrorDocument 404 /404.html
			php_value auto_append_file /srv/src/0sjob/config/close_connect.php
			php_value auto_prepend_file /srv/src/0sjob/config/connect.php

			# Лог ошибок PHP
			php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log


			RewriteEngine On

            RewriteCond %{HTTP_HOST} ^(mil|mil-educ|mosreg|oboronservis|pskov-adm|pskovgov|r77fssprus|sobes73|ul|ulgov)\.
            RewriteCond %{QUERY_STRING} _escaped_fragment_
            RewriteCond %{QUERY_STRING} !vakansii
            RewriteRule ^(.*)$ http://www.0sjob.ru/ewidgets/vacancylist/get/escaped_fragments [L,R=302]

            RewriteCond %{HTTP_HOST} ^(mil|mil-educ|mosreg|oboronservis|pskov-adm|pskovgov|r77fssprus|sobes73|ul|ulgov)\.
            RewriteCond %{QUERY_STRING} _escaped_fragment_
            RewriteRule ^(.*)$ http://www.0sjob.ru/ewidgets/vacancy/get/escaped_fragments [L,R=302]

            # Правила для сабдоменов
            RewriteCond %{HTTP_HOST} ^mil\.
            RewriteRule ^$ "/sj/#!/?catalogues=151" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^mil-educ\.
            RewriteRule ^$ "/sj/#!/?catalogues=271,272,273,274,276,277,278,279,280,281&published=1" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^mosreg\.
            RewriteRule ^$ "/sj/#!/?o=46&published=1" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^oboronservis\.
            RewriteRule ^$ "/sj/#!/?id_type=20&published=1" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^pskov-adm\.
            RewriteRule ^$ "/sj/#!/?published=1&o=58" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^pskovgov\.
            RewriteRule ^$ "/sj/#!/?id_type=1&published=1&o=58" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^r77fssprus\.
            RewriteRule ^$ "/sj/#!/?id_client=238499&archive=0&published=1" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^sobes73\.
            RewriteRule ^$ "/sj/#!/?id_type=1&o=73" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^ul\.
            RewriteRule ^$ "/sj/#!/?o=73" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^ulgov\.
            RewriteRule ^$ "/sj/#!/?id_type=1&o=73" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^nalog\.
            RewriteRule ^$ "/sj/#!/?id_type=19" [NE,L,R]

            RewriteCond %{HTTP_HOST} ^fms\.
            RewriteRule ^$ "/sj/#!/?catalogues=472,475,547,504,552,311,313,319,88&payment_to=30000&pay0=1&no_agreement=1&pol=0&worktype=0&experience=1&education=0&nolang=1&agency=0" [NE,L,R]


            # ОТКАТЫВАЕМ: "SEO-383 пробуем кириллицу в url"
            RewriteRule ^vakansii/дизайнер-мебели.html /vakansii/dizajner-mebeli.html [R=301,L]
            RewriteRule ^vakansii/инженер-строитель.html /vakansii/inzhener-stroitel.html [R=301,L]

			# SEO-321 catalog-vacancies -> rabota | catalog-resumes -> rezumes
			RewriteRule ^catalog-vacancies/(.*) /vakansii/$1 [R=301,L]
			RewriteRule ^archive/catalog-vacancies/(.*) /vakansii/archive/$1 [R=301,L]
			RewriteRule ^catalog-resumes/(.*) /resume/$1 [R=301,L]
			RewriteRule ^vacancii/(.*) /vakansii/$1 [R=301,L]
			# /rabota/vacancy-* -> /vakansii/*
			RewriteRule ^rabota/vacancy-([0-9]+\.html) /vakansii/vacancy-$1 [R=301,L]
			RewriteRule ^rabota/vacancy-(.+\.html) /vakansii/$1 [R=301,L]
			RewriteRule ^rabota/archive/(.*) /vakansii/archive/$1 [R=301,L]
			RewriteRule ^resume/index.php /index.html [L,NC]

			# просмотр вебни xhprof что-то глючит, лечим реврайтом
			RewriteRule ^admin/developer/xhprof/xhprof_html/index.html/(.*)$ admin/developer/xhprof/xhprof_html/$1 [QSA,L]

            # SEO-258 редиректы с убитого проекта Подработка
            RewriteCond %{REQUEST_URI} ^/services/.* [NC,OR]
            RewriteCond %{REQUEST_URI} ^/vremennaya_rabota/uslugi/.* [NC,OR]
            RewriteCond %{REQUEST_URI} ^/media/([0-9]+)/download.* [NC]
            RewriteRule ^(.*)$ /resume/ [R=301,L]

            RewriteCond %{REQUEST_URI} ^/projects/.* [NC,OR]
            RewriteCond %{REQUEST_URI} ^/projects$ [NC,OR]
            RewriteCond %{REQUEST_URI} ^/vremennaya_rabota/.* [NC]
            RewriteRule ^(.*)$ /vakansii/ [R=301,L]
            # SEO-258

			# Правило для внутреннего редиректа всех страниц админки на yii
			RewriteCond %{REQUEST_URI} ^/+admin.* [OR]
			RewriteCond %{REQUEST_URI} ^/+support.*
			RewriteCond %{REQUEST_URI} !^/admin/yii/admin\.php.*
			RewriteCond %{REQUEST_URI} !^/admin/yii/index\.php.*
			RewriteCond %{REQUEST_URI} !^/admin/remote_scripts/.*
			RewriteCond %{REQUEST_URI} !^/admin/developer/xhprof/xhprof_html/(css|js|jquery)/.*
			RewriteRule ^(.*) /admin/yii/admin.php/$1 [QSA,L]

			# ssl доступ к img с https://www.superjob.ru
			RewriteRule ^ssl/img/(.*)$ /img/$1 [L]

			# Перенаправляем мобильные устройства, которые пытаются искать иконки в корне
			RewriteRule ^apple-touch-icon([0-9x-]*-precomposed).png$ http://img.0sjob.ru/img/ico/mobile/other/apple-touch-icon-114x114.png [L,R=301]
			RewriteRule ^apple-touch-icon([0-9x-]*).png$ http://img.0sjob.ru/img/ico/mobile/ios/apple-touch-icon-114x114.png [L,R=301]

			# Эксперимент с транслитерацией
			RewriteRule ^kalendar/?$ /proizvodstvennyj_kalendar/ [R=301,L]
			RewriteRule ^proizvodstvennyj_kalendar/$ index.html [L]

			RewriteRule ^trudovoj_kodeks_tk_rf$ /trudovoj-kodeks/ [R=301,L]
			RewriteRule ^trudovoj_kodeks_tk_rf/(.*)$ /trudovoj-kodeks/$1 [R=301,L]
			RewriteRule ^trudovoj-kodeks/(.*)$ /info/tk/$1 [L]
			RewriteRule ^trudovoj_kodeks_tk_ua/(.*)$ /info/tkua/$1 [L]

			# QRcode
			RewriteRule ^(resume|vacancy)/qrcode/(notauth|auth)/([0-9]+).png$ /static_content/qrcode.php?auth=$2&entity=$1&id=$3 [L]

			# download_static (new)
            RewriteCond %{QUERY_STRING} hash
			RewriteRule ^cdn/([^/]+)/([^/]+)/([^/]+)/(.*)\.(js|css|gif|png|jpg|svg|eot|ttf|otf|woff)$ /static_content/download_static.html?mode=$1&type=$2&module=$3&path=$4.$5 [QSA,L]

			# download_static (old)
            RewriteRule ^cdn/([^/]+)/([^/]+)/([^/]+)/([^/]+)/(.*)\.(js|css|gif|png|jpg|svg|eot|ttf|otf|woff)$ /static_content/download_static.html?mode=$1&type=$2&module=$3&hash=$4&path=$5.$6 [L]
			RewriteRule ^stc/(.*\.)(ver[.0-9]+)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$3&%{QUERY_STRING} [L]
			RewriteRule ^libb/stc/(.*\.)(ver[.0-9]+)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$3&lib=1&%{QUERY_STRING} [L]
			RewriteRule ^stc/(.*\.)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$2&%{QUERY_STRING} [L]
			RewriteRule ^libb/stc/(.*\.)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$2&lib=1&%{QUERY_STRING} [L]

			# Справка для ФНС
			RewriteRule ^help/?$ /text/help/ [R,L]

			# МИНОБОРОН
			RewriteRule ^mil/?$ /info/mil/ [L]

			# Иконка для nalog.superjob.ru
			RewriteCond %{HTTP_HOST} ^nalog\.
			RewriteRule ^favicon.ico$ http://img.0sjob.ru/img/favicons/nalog.ico [L]

			# Кнопка для давно не обновлявшихся сайтов
			RewriteRule ^_bann/88_1.gif$ /images/button_superjob.gif [L]
			RewriteRule ^rus/top.phtml$ /images/button_superjob.gif [L]
			RewriteRule ^88jm.gif$ /images/button_superjob.gif [L]

			# Проверка авторизации для клиентов
			RewriteRule ^a/?$  /info/checkup/hr_user_auth.html [R,L]

			#msk
			RewriteCond %{HTTP_HOST} ^msk\.
			RewriteRule ^robots.txt$ /robotsmsk.txt [L]

			# Зарплатомер


			RewriteCond %{HTTP_HOST} 0sjob.ru
			RewriteCond %{REQUEST_URI} ^/zarplatomer/
			RewriteRule ^zarplatomer/(.*) http://www.zarplatomer.ru/$1 [R=301,L]

			RewriteCond %{HTTP_HOST} 0sjob.ua
			RewriteCond %{REQUEST_URI} ^/zarplatomer/
			RewriteRule ^zarplatomer/(.*) http://www.zarplatomer.ua/$1 [R=301,L]

			RewriteCond %{HTTP_HOST} zarplatomer
			#RewriteRule ^$ info/announcement.html?id=785 [L]
			RewriteRule ^$ zarplatomer/index.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^index.html$ zarplatomer/index.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^about.html$ zarplatomer/about.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			#RewriteRule ^payment.html$ info/announcement.html?id=785 [L]
			RewriteRule ^payment.html$ zarplatomer/payment.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^payment_start.html$ zarplatomer/payment_start.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^advert.html$ zarplatomer/advert.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^magazines.html$ zarplatomer/magazines.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^contacts.html$ zarplatomer/contacts.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^regions.html$ zarplatomer/regions.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^licences.html$ zarplatomer/licences.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^image.html$ zarplatomer/image.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^subscription.html$ zarplatomer/subscription.html [L]

			RewriteCond %{HTTP_HOST} zarplatomer
			RewriteRule ^robots.txt$ zarplatomer/robots.txt [L]

			# Файл robots.txt (Эта директива должна указываться в конце блока, чтобы не перехватывать другие вызовы)
			RewriteRule ^robots.txt$ /robots.php [L]
			RewriteRule ^robots.php$ - [L]

			# Ссылки для не-роботов на версии резюме и вакансий для печати
			RewriteRule ^print/resume/.* index.html [L]
			RewriteRule ^print/vakansii/.* index.html [L]
			RewriteRule ^print/(.*)/?$ /$1/?%{QUERY_STRING}&print_version=1

			# Архивные вакансии
			RewriteRule ^vacancy/archive/$ /vacancy/?show_archive=1&%{QUERY_STRING}

			# Архивного поиска вакансий больше нет
			RewriteRule ^archive/vacancy/search/(.*) /vacancy/search/$1 [R=301,L]

			# Отдельные страницы для поиска вакансий с типом Временная работа и вакансий с местом работы Работа на дому
			RewriteRule ^vacancy/search/home_work/$ /vacancy/search/?place_of_work=2&%{QUERY_STRING}
			RewriteRule ^vacancy/search/part_time/$ /vacancy/search/?type_of_work=13&%{QUERY_STRING}

			# Уникальный урл для последнего шага добавления резюме
			RewriteRule ^resume/resume_add_success.html$ /resume/resume_add.html


# Обращение к файлам Я.Вебмастер
RewriteRule ^(yandex_.+\.txt)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^(yandex_.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация mail.ru
RewriteRule ^(wmail_.+\.html)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^mailru-verification(.+)\.html$ /webmasters_verification.php?st=$1&type=mailru_postmaster [L]

# Верификация google
RewriteRule ^(google.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация bing
RewriteRule ^(BingSiteAuth.xml)$ /webmasters_verification.php?st=$1 [L]

# Верификация googleadx
RewriteRule ^(googleadx.+\.html)$ /webmasters_verification.php?st=$1 [L]

RewriteRule ^webmasters_verification.php$ - [L]


			# похоже, mod_rewrite не распознает в REQUEST_URI символы, закодированные в windows-1251
			# поэтому приходится делать редирект из PHP
			# SEO-321 Убрал как не актуальные, но нужно посмотреть не будет ли ошибок.
			# RewriteRule ^(resume|rabota)/.+ index.html [L,NC]
			# RewriteRule ^archive/rabota/.+ index.html [L,NC]
			# RewriteRule ^(resume|rabota) /fix_url_encoding.php [L,NC]
			# RewriteRule ^archive/rabota /fix_url_encoding.php [L,NC]

			# InfoController тоже должен быть запущен из основного входного скрипта
			RewriteRule ^info/$ /index.html [L,NC]
			RewriteRule ^reklama/$ /index.html [L,NC]

			# редирект со страниц вида www.superjob.ru/index.html на www.superjob.ru/
			RewriteCond %{THE_REQUEST} ^[A-Z]{3,}\ /index\.html/?(.*)\ HTTP/
			RewriteRule ^index\.html/?$ / [R=301,L]

			# Remove multiple slashes after domain
			RewriteCond %{HTTP_HOST} !=""
			RewriteCond %{THE_REQUEST} ^[A-Z]+\s//+(.*)\sHTTP/[0-9.]+$ [OR]
			RewriteCond %{THE_REQUEST} ^[A-Z]+\s(.*/)/+\sHTTP/[0-9.]+$
			RewriteRule .* http://%{HTTP_HOST}/%1 [R=301,L]

			# Remove multiple slashes anywhere in URL
			RewriteCond %{REQUEST_URI} ^(.*)//(.*)$
			RewriteRule . %1/%2 [R=301,L]

			# if a directory or a file exists, use it directly
			RewriteCond %{REQUEST_FILENAME} -s [OR]
			RewriteCond %{REQUEST_FILENAME} -l [OR]
			RewriteCond %{REQUEST_FILENAME} -d
			# then
			RewriteRule ^.*$ - [NC,L]
			# else if directory or a file exists without town path, use it directly
			RewriteCond %{REQUEST_URI} ^/(vladivostok|barnaul)/(.*)
			RewriteRule ^(novosibirsk|vladivostok|barnaul)/(.*) http://%1.0sjob.ru/$2 [R=301,L]
			RewriteCond %{REQUEST_URI} ^/(novosibirsk)/(.*)
			RewriteRule ^(novosibirsk)/(.*) http://nsk.0sjob.ru/$2 [R=301,L]
			# else forward it to index.php
			RewriteRule ^.*$ index.html [NC,L]
		</Directory>

		<Directory /srv/src/0sjob/api/html/includes>
			Require all denied
		</Directory>


		<Directory /srv/src/0sjob/img/>
			# Use http://img.0sjob.ru/img/
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/yii/protected/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/xml/partners/includes/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/admin/>
			php_value auto_prepend_file /srv/src/0sjob/admin/connect.php
		</Directory>

		<Directory /srv/src/0sjob/adv/>
			php_value auto_prepend_file /srv/src/0sjob/admin/connect.php
			RewriteEngine On
			RewriteCond $0 !\.(gif|jpg|png|ico|css|js|swf|wav|mp3|less|cur)
			RewriteRule ^.*$ index.html
		</Directory>

		<Directory /srv/src/0sjob/support/>
			php_value auto_prepend_file /srv/src/0sjob/admin/connect.php
		</Directory>

		# Каталог без пересылки на www для отладки Opera
		<Directory /srv/src/0sjob/noredir/>
			php_value auto_prepend_file none
			php_value auto_append_file none
		</Directory>

		<Directory /srv/src/0sjob/admin/crontab/>
			Require ip 10.10.0.0/24 172.16.0.0/28
			php_value auto_prepend_file none
			Options +Indexes
		</Directory>

		<Directory /srv/src/0sjob/admin/data_update/>
			Options +Indexes
		</Directory>

		<Directory /srv/src/0sjob/admin/remote_scripts/>
			Require ip  10.10.0.0/23 10.10.8.0/21 172.16.0.0/24 91.206.146.0/23 127.0.0.1
			php_value auto_prepend_file none
			php_value auto_append_file none
			Options +Indexes
		</Directory>

		<Directory /srv/src/0sjob/bin/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/config/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/lib/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/functions/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/includes/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/vendor/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/hr/includes/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/node/>
			Require all denied
		</Directory>

		<Directory /srv/src/0sjob/export/rss/>
			RewriteEngine On
			RewriteRule ^community/([0-9a-zA-Z_]+).xml rss_rewrite.php?type=community&filename=$1&%{QUERY_STRING}
			RewriteRule ^([0-9a-zA-Z_]+).xml rss_stat.php?filename=$1.xml&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/info/toolbar/>
			RewriteEngine On
			RewriteRule ^([0-9a-zA-Z_]+).xml toolbar_rewrite.php?mr_toolbar=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/export/settings/>
			RewriteEngine On
			RewriteRule ^([0-9a-zA-Z_]+).xml rss_stat.php?filename=$1.xml&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/paymentindex/>
			# URL обязательно должен оканчиваться символом "/"
			RewriteEngine On
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод статьи по номеру (старый урл для топиков - без ключа сообщества)
			RewriteRule ^([0-9a-z]+)/$ index.html?mr_page=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/contests/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			#RewriteRule ^([0-9a-zA-Z]+)/list/$ index.html?contest_key=$1&%{QUERY_STRING}
			#RewriteRule ^([0-9a-zA-Z]+)/([0-9]+)/$ index.html?contest_key=$1&id=$2&%{QUERY_STRING}
			#RewriteRule ^([0-9]+)/$ index.html?id=$1&%{QUERY_STRING}
			#RewriteRule ^([0-9a-zA-Z]+)/$ contest.html?contest_key=$1&%{QUERY_STRING}

			RewriteRule ^([0-9a-zA-Z]+)/([0-9]+)/$ /contests/$2?%{QUERY_STRING} [R=301,L]

			# Вывод комента по номеру
			RewriteRule ^message/([0-9]+)/([0-9]+)/$ index.html?mr_id=$2&mr_id_message=$1&%{QUERY_STRING}

			#Главная страница конкурса
			RewriteRule ^([0-9]+)/$ index.html?mr_id=$1&%{QUERY_STRING}

			#Добавить новый рассказ
			RewriteRule ^([0-9a-zA-Z]+)/story/$ index.html?mr_action=story&mr_contest_key=$1&%{QUERY_STRING}
			RewriteRule ^([0-9a-zA-Z]+)/story/([0-9]+)/$ index.html?mr_action=story&mr_contest_key=$1&mr_id=$2&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса
			RewriteRule ^([0-9a-zA-Z]+)/list/$ index.html?mr_action=list&mr_contest_key=$1&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса сортировка по дате
			RewriteRule ^([0-9a-zA-Z]+)/list/date/$ index.html?mr_action=list&mr_contest_key=$1&mr_order=date&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса сортировка по просмотрам
			RewriteRule ^([0-9a-zA-Z]+)/list/views/$ index.html?mr_action=list&mr_contest_key=$1&mr_order=views&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса сортировка по голосам
			RewriteRule ^([0-9a-zA-Z]+)/list/votes/$ index.html?mr_action=list&mr_contest_key=$1&mr_order=votes&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса сортировка по кол-ву комментов
			RewriteRule ^([0-9a-zA-Z]+)/list/count_comments/$ index.html?mr_action=list&mr_contest_key=$1&mr_order=count_comments&%{QUERY_STRING}

			# Выводим список рассказов конкретного конкурса сортировка по дате последнего комментария
			RewriteRule ^([0-9a-zA-Z]+)/list/date_last_comment/$ index.html?mr_action=list&mr_contest_key=$1&mr_order=date_last_comment&%{QUERY_STRING}

			# Ввыодим регламент конкурса
			RewriteRule ^([0-9a-zA-Z]+)/regulations/$ index.html?mr_action=regulations&mr_contest_key=$1&%{QUERY_STRING}

			# Ввыодим список призов конкурса
			RewriteRule ^([0-9a-zA-Z]+)/prizes/$ index.html?mr_action=prizes&mr_contest_key=$1&%{QUERY_STRING}

			# Ввыодим список спонсоров конкурса
			RewriteRule ^([0-9a-zA-Z]+)/sponsors/$ index.html?mr_action=sponsors&mr_contest_key=$1&%{QUERY_STRING}

			# Ввыодим результат конкурса
			RewriteRule ^([0-9a-zA-Z]+)/result/$ index.html?mr_action=result&mr_contest_key=$1&%{QUERY_STRING}

			#Главная страница конкурса
			RewriteRule ^([0-9a-zA-Z]+)/$ index.html?mr_contest_key=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/research/>
			php_value auto_prepend_file /srv/src/0sjob/research/connect.php
		</Directory>

		<Directory /srv/src/0sjob/research/order/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод формы заказа по строковому ключу
			RewriteRule ^([a-z0-9]+)/$ index.html?mr_category=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/yii/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]
		</Directory>

		<Directory /srv/src/0sjob/research/articles/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод комента по номеру
			RewriteRule ^message/([0-9]+)/([0-9]+)/$ index.html?mr_id_article=$2&mr_id_message=$1&%{QUERY_STRING}

			# Вывод статьи по номеру
			RewriteRule ^([0-9]+)/([a-zA-Z0-9_\-]+)?/?$ index.html?mr_id_article=$1&mr_title_article=$2&%{QUERY_STRING}

			# Вывод категории по строковому ключу
			RewriteRule ^([a-z0-9]+)/$ index.html?mr_key_category=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/research/news/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод новости по номеру
			RewriteRule ^([0-9]+)/$ index.html?mr_id_news_article=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/pro/>
			# URL обязательно должен оканчиваться символом "/"
			RewriteEngine On
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод комента по номеру
			RewriteRule ^message/([0-9]+)/([0-9]+)/$ index.html?mr_id_article=$2&mr_id_message=$1&action=mr_view_article&%{QUERY_STRING}

			# Вывод информацию по автору
			RewriteRule ^persons/([0-9]+)/$ index.html?mr_id_person=$1&action=mr_view_person&%{QUERY_STRING}

			# Вывод статьи по номеру
			RewriteRule ^([0-9]+)/$ index.html?mr_id_article=$1&action=mr_view_article&%{QUERY_STRING}

			# Вывод категории по строковому ключу
			RewriteRule ^(([a-z0-9_]+/){1,})$ index.html?mr_full_path=$1&action=mr_cat_articles_list&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/community/>
			# URL обязательно должен оканчиваться символом "/"
			RewriteEngine On
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод избранных сообществ
			RewriteRule ^selected_communities/$ index.html?action=mr_selected_communities&%{QUERY_STRING}

			# Вывод комента по номеру
			RewriteRule ^message/([0-9]+)/([0-9]+)/$ index.html?mr_id_topic=$2&mr_id_message=$1&action=mr_view_topic&%{QUERY_STRING}

			# Список последних тем
			RewriteRule ^list\.html$ index.html?action=mr_list&%{QUERY_STRING}

			# Вывод статьи по номеру (новый урл для топиков - с ключем сообщества)
			RewriteRule ^([a-z0-9_]+)/([0-9]+)/$ index.html?mr_community_key=$1&mr_id_topic=$2&action=mr_view_topic&%{QUERY_STRING}

			# Вывод статьи по номеру (старый урл для топиков - без ключа сообщества)
			RewriteRule ^([0-9]+)/$ index.html?mr_id_topic=$1&action=mr_view_topic&%{QUERY_STRING}

			# Вывод категории по строковому ключу
			RewriteRule ^(([a-z0-9_]+/){1,})$ index.html?mr_full_path=$1&action=mr_cat_topics_list&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/groups/>
			# URL обязательно должен оканчиваться символом "/"
			RewriteEngine On
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Список группы
			RewriteRule ^list/$ index.html?action=mr_groups_list&%{QUERY_STRING}

			# Просмотр группы
			RewriteRule ^([0-9]+)/$ index.html?action=mr_view_group&mr_id_group=$1&%{QUERY_STRING}

			# Просмотр тем группы
			RewriteRule ^([0-9]+)/topics/$ index.html?action=mr_topics_list&mr_id_group=$1&%{QUERY_STRING}

			# Просмотр темы
			RewriteRule ^topics/([0-9]+)/$ index.html?action=mr_view_topic&mr_id_topic=$1&%{QUERY_STRING}

			# Просмотр участников группы
			RewriteRule ^([0-9]+)/members/$ index.html?action=mr_members_list&mr_id_group=$1&%{QUERY_STRING}

			# Вывод комента по номеру. Переделать!!!!!
			RewriteRule ^topics/message/([0-9]+)/([0-9]+)/$ /groups/message/$1/$2/ [R,L]
			RewriteRule ^message/([0-9]+)/([0-9]+)/$ index.html?mr_id_topic=$2&mr_id_message=$1&action=mr_view_topic&%{QUERY_STRING}

			# Просмотр последних тем
			RewriteRule ^topics/$ index.html?action=mr_last_topics&%{QUERY_STRING}

			# Черный список группы
			RewriteRule ^([0-9]+)/blacklist/$ index.html?action=mr_group_blacklist&mr_id_group=$1&%{QUERY_STRING}

			# ??нформация о группе
			RewriteRule ^([0-9]+)/info/$ index.html?action=mr_group_info&mr_id_group=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/profile/>
			# URL обязательно должен оканчиваться символом "/"
			RewriteEngine On
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			# Вывод статьи по номеру
			RewriteRule ^([0-9]+)/$ index.php?mr_id_reg_user=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/text/>
			RewriteEngine On

			# Добавляем слеш в конце
			RewriteRule ^[a-zA-Z0-9_\-]+(/[a-zA-Z0-9_\-]+)*$  %{REQUEST_URI}/ [R,L]

			RewriteRule ^(.+)/print/$ index.html?mr_key=$1&print_version=1&%{QUERY_STRING}
			RewriteRule ^(.+)/$ index.html?mr_key=$1&%{QUERY_STRING}
		</Directory>

		<Directory /srv/src/0sjob/js/admin/modules/mailing_list/templates>
			Allow From All
			AddDefaultCharset utf-8
			php_value auto_append_file none
			php_value auto_prepend_file none
		</Directory>

		# Предназначено для тестовых и девелоперских серверов, у которых НЕ настроен соответствующий location в nginx
		# На боевом сервере /xsendfile/public это internal location в nginx, который проксирует запрос на public
		<Location /xsendfile/public/>
			RewriteEngine On
			RewriteRule /xsendfile/public/(.*) http://public.0sjob.ru/$1 [R=302,L]
			Require ip 127.0.0.1/8 10.10.0.0/16 172.16.2.0/23
		</Location>
</VirtualHost>

#pr
<VirtualHost *:81>
	ServerName 0pr.ru
	ServerAlias *.0pr.ru

	DocumentRoot /srv/src/0sjob
	ErrorLog /srv/src/0sjob.var/apache/0sjob.ru_error.log
	CustomLog /srv/src/0sjob.var/apache/0sjob.ru_access.log combined

	AddType text/html .php .php3 .html .phtml .inc
	AddHandler application/x-httpd-php .php .php3 .html .phtml .inc

	php_value blitz.enable_comments 1
	php_value blitz.enable_alternative_tags 0
	php_flag magic_quotes_gpc off
	AddType text/x-component .htc

	<Directory /srv/src/0sjob/>
		Require all granted
		AllowOverride None

		ErrorDocument 404 /404.html
		php_value auto_append_file /srv/src/0sjob/config/close_connect.php
		php_value auto_prepend_file /srv/src/0sjob/config/connect.php

		# Лог ошибок PHP
		php_value error_log /srv/src/0sjob.var/error_logs/php_error_log.log

		RewriteEngine On

		# Всё на www., иначе будет открываться sj
		RewriteCond %{HTTP_HOST} !^www\.0pr\.ru [NC]
		RewriteRule ^(.*)$ http://www.0pr.ru/$1 [L,R=301]

		# Правило для внутреннего редиректа всех страниц админки на yii
		RewriteCond %{REQUEST_URI} ^/+admin.* [OR]
		RewriteCond %{REQUEST_URI} ^/+support.*
		RewriteCond %{REQUEST_URI} !^/admin/yii/admin\.php.*
		RewriteCond %{REQUEST_URI} !^/admin/yii/index\.php.*
		RewriteCond %{REQUEST_URI} !^/admin/remote_scripts/.*
		RewriteCond %{REQUEST_URI} !^/admin/developer/xhprof/xhprof_html/(css|js|jquery)/.*
		RewriteRule ^(.*) /admin/yii/admin.php/$1 [QSA,L]

		# ssl доступ к img с https://www.superjob.ru
		RewriteRule ^ssl/img/(.*)$ /img/$1 [L]

		# Перенаправляем мобильные устройства, которые пытаются искать иконки в корне
		RewriteRule ^apple-touch-icon-precomposed.png$ http://img.0sjob.ru/img/ico/mobile/other/apple-touch-icon-114x114.png [L,R=301]
		RewriteRule ^apple-touch-icon.png$ http://img.0sjob.ru/img/ico/mobile/ios/apple-touch-icon-114x114.png [L,R=301]

		RewriteRule favicon.ico$ - [NC,L]

		# download_static (new)
		RewriteRule ^cdn/([^/]+)/([^/]+)/([^/]+)/(.*)\.(js|css|gif|png|jpg|svg|eot|ttf|otf|woff)$ /static_content/download_static.html?mode=$1&type=$2&module=$3&path=$4.$5 [QSA,L]

		# download_static (old)
		RewriteRule ^stc/(.*\.)(ver[.0-9]+)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$3&%{QUERY_STRING} [L]
		RewriteRule ^libb/stc/(.*\.)(ver[.0-9]+)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$3&lib=1&%{QUERY_STRING} [L]
		RewriteRule ^stc/(.*\.)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$2&%{QUERY_STRING} [L]
		RewriteRule ^libb/stc/(.*\.)(js|css|gif|png|jpg)$ /static_content/download_static.html?file=$1$2&lib=1&%{QUERY_STRING} [L]


# Обращение к файлам Я.Вебмастер
RewriteRule ^(yandex_.+\.txt)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^(yandex_.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация mail.ru
RewriteRule ^(wmail_.+\.html)$ /webmasters_verification.php?st=$1 [L]
RewriteRule ^mailru-verification(.+)\.html$ /webmasters_verification.php?st=$1&type=mailru_postmaster [L]

# Верификация google
RewriteRule ^(google.+\.html)$ /webmasters_verification.php?st=$1 [L]

# Верификация bing
RewriteRule ^(BingSiteAuth.xml)$ /webmasters_verification.php?st=$1 [L]

# Верификация googleadx
RewriteRule ^(googleadx.+\.html)$ /webmasters_verification.php?st=$1 [L]

RewriteRule ^webmasters_verification.php$ - [L]


		# Иначе сработает правило ниже
		RewriteRule ^static_content/download_static - [NC,L]

		# Админку оставляем как есть
		RewriteCond %{REQUEST_URI} ^/admin [OR]
		RewriteCond %{REQUEST_URI} ^/sso
		RewriteRule .* - [NC,L]

		RewriteRule ^robots.txt$ /robots.php [L]
		RewriteRule ^robots.php$ - [L]

		# Всегда перенаправляем на yii,
		# что бы не срабатывали каталоги /community/, /groups/, etc.
		RewriteRule ^.*$ index.html [NC,L]
	</Directory>

	<Directory /srv/src/0sjob/admin/>
		php_value auto_prepend_file /srv/src/0sjob/admin/connect.php
	</Directory>
</VirtualHost>
